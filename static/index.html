<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WS Arbitrage Scanner</title>
  <style>
    body { background: #0d1117; color: #c9d1d9; font-family: sans-serif; }
    .container { max-width: 900px; margin: 30px auto; padding: 10px; }

    h1 { text-align: center; color: #58a6ff; margin-bottom: 20px; }

    /* Controls layout */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .controls label { display: block; margin-bottom: 5px; font-size: 14px; }
    .controls input, .controls select, .controls button {
      padding: 8px;
      border-radius: 6px;
      border: none;
      font-size: 14px;
    }
    .controls input, .controls select { background: #161b22; color: #c9d1d9; }
    .controls button {
      background: #238636;
      color: white;
      cursor: pointer;
    }
    .controls button:hover { background: #2ea043; }

    /* Mobile: column layout */
    @media (max-width: 768px) {
      .controls { flex-direction: column; }
      .controls > div, .controls button { width: 100%; }
    }

    /* Desktop: row layout */
    @media (min-width: 769px) {
      .controls { flex-direction: row; align-items: flex-end; }
      .controls > div { flex: 1; }
    }

    /* Results table */
    #results-container {
      display: none;
      margin-top: 20px;
      overflow: auto;
      max-height: 400px;
      border: 1px solid #30363d;
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
    }
    thead {
      background: #1f6feb;
      color: white;
    }
    thead th {
      padding: 10px;
      border: 1px solid #30363d;
      text-align: left;
      position: sticky;
      top: 0;              /* Sticky header */
      z-index: 2;
    }
    tbody td {
      padding: 8px;
      border: 1px solid #30363d;
    }

    /* Alternating row colors */
    tbody tr:nth-child(even) { background-color: #161b22; }
    tbody tr:nth-child(odd) { background-color: #0d1117; }

    /* Profit color coding */
    .profit-positive { color: #2ea043; font-weight: bold; }
    .profit-negative { color: #f85149; font-weight: bold; }
    .profit-zero { color: #8b949e; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Arbitrage Scanner</h1>

    <div class="controls">
      <div>
        <label for="exchange">Exchange</label>
        <select id="exchange">
          <option value="binance">Binance</option>
          <option value="bybit">Bybit</option>
          <option value="gateio">Gate.io</option>
          <option value="kucoin">Kucoin</option>
        </select>
      </div>
      <div>
        <label for="profit">Min Profit %</label>
        <input type="number" id="profit" value="0" step="0.1" />
      </div>
      <div>
        <label for="collect">Collect Window (s)</label>
        <input type="number" id="collect" value="2" step="1" />
      </div>
      <button onclick="scan()">Scan</button>
    </div>

    <div id="results-container">
      <table id="results-table">
        <thead>
          <tr>
            <th>Triangle</th>
            <th>Pairs</th>
            <th>Profit% Before Fee</th>
            <th>Fee</th>
            <th>Profit% After Fee</th>
          </tr>
        </thead>
        <tbody id="results-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    async function scan() {
      const exchange = document.getElementById("exchange").value;
      const profit = parseFloat(document.getElementById("profit").value);
      const collect = parseInt(document.getElementById("collect").value);

      const payload = {
        exchanges: [exchange],
        min_profit: profit,
        collect_seconds: collect
      };

      const res = await fetch("/scan", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (res.ok) {
        const data = await res.json();
        const tbody = document.getElementById("results-body");
        tbody.innerHTML = "";

        if (data.length > 0) {
          data.forEach(item => {
            const profitAfter = item.profit_after || 0;
            let profitClass = "profit-zero";
            if (profitAfter > 0) profitClass = "profit-positive";
            else if (profitAfter < 0) profitClass = "profit-negative";

            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${item.triangle || "-"}</td>
              <td>${item.pairs || "-"}</td>
              <td>${item.profit_before?.toFixed(2) || "0"}%</td>
              <td>${item.fee || "0.300"}%</td>
              <td class="${profitClass}">${profitAfter.toFixed(2)}%</td>
            `;
            tbody.appendChild(row);
          });
          document.getElementById("results-container").style.display = "block";
        } else {
          document.getElementById("results-container").style.display = "none";
        }
      } else {
        alert("Scan failed: " + res.status);
      }
    }
  </script>
</body>
</html>
